language: shell
sudo: false
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"

jobs:
  include:
    - os: windows
      before_install:
        - scripts/install_jdk_windows.sh
        - export JAVA_HOME=$HOME/jdk-13
        - export BADASS_RUNTIME_JPACKAGE_HOME=$HOME/jdk-14
        - "./scripts/install_openjfx.sh windows"
    - os: osx
      before_install:
        - scripts/install_jdk_mac.sh
        - export JAVA_HOME=$HOME/jdk-13/Contents/Home
        - export BADASS_RUNTIME_JPACKAGE_HOME=$HOME/jdk-14/Contents/Home
        - "./scripts/install_openjfx.sh mac"

install: "./gradlew assemble --no-daemon"

before_deploy:
  - "./gradlew zip --no-daemon"
  - ls ./build/distributions/

deploy:
  provider: releases
  api_key:
    secure: vmquf+Ebdy5/TRFlrkj8tPMhqgVV9DGtBIGER0+Y1PgwU39guawTPlkW9IG/gusf7IYqBFMcMqNt/d7VH/fg3W0cex7qRd2eSYXbApt3xxN2Iw+HvWdaOSKnwKyeh23pD90lFs6aGka/srWJXV6p0vxTkhTeOGfoaNWpTVL7rlrM4vFjxhFB8CEkHrMqJOpzSrueSzJO7ZsMTTVKNSu4iUg2TIqdvCv8TYHaQ63kIN0uHOkF8zqixQapg6zb+kOXyuCqHBL5MuJ1foTjkx1uOEIjGEDF0FQq8J1eZUFM3lDiCIu2wPsjIPEMjdGUH1tTDGgaTOtEV3T5HaqRKF5tpxk0sUduE4a9yPV+zrRpUlF/bLD9BtfXeyCrnqjJubJONcdjIN5u0ia1fmcTuAMhumNQCWx5WWQNfaGMM4jPKppz18VHmbSUvtBY0g53wk6ajFdLoYHsQ2RAJB13gU73AhcuYNGcLr7LE4TmfNHPuiVXicA4jELWwikzbNCc8gc0VASXuSSad+/lpeJZY2+CwGNkg2vY2FH6JEhnIJPUQ91X+cKp4dazsBjwkVXAf/wW3Nxu8tWKlZ/AyZ4pVZoCIp+/p4KgVEvVDTWqEoD1HtKfn8l1iUATlEcD0Z7/mce0ffjMRcnv14uVfDMirmLdaH89v756XRdABb1wMxyCsXY=
  skip_cleanup: true
  file_glob: true
  file: './build/distributions/*'
  on:
    repo: Hilde/transaction-dl
    tags: true
